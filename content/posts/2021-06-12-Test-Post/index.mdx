---
title: Test Post
slug: test post
author: Marlon Johnson
date: June 12, 2021
tags: ['Life', 'React', 'random', 'TypeScript']
excerpt: Testing the new Blog Format
---

There are many articles written about React performance optimizations. In general, if some state update is slow, you need to:

1. Verify you’re running a production build. (Development builds are intentionally slower, in extreme cases even by an order of magnitude.)
2. Verify that you didn’t put the state higher in the tree than necessary. (For example, putting input state in a centralized store might not be the best idea.)
3. Run React DevTools Profiler to see what gets re-rendered, and wrap the most expensive subtrees with `memo()`. (And add `useMemo()` where needed.)

This last step is annoying, especially for components in between, and ideally a compiler would do it for you. In the future, it might.

**In this post, I want to share two different techniques.** They’re surprisingly basic, which is why people rarely realize they improve rendering performance.

**These techniques are complementary to what you already know!** They don’t replace `memo` or `useMemo`, but they’re often good to try first.

## An (Artificially) Slow Component

Here’s a component with a severe rendering performance problem:

```javascript
import { useState } from 'react';

export default function App() {
  let [color, setColor] = useState('red');
  return (
    <div>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p style={{ color }}>Hello, world!</p>
      <ExpensiveTree />
    </div>
  );
}

function ExpensiveTree() {
  let now = performance.now();
  while (performance.now() - now < 100) {
    // Artificial delay -- do nothing for 100ms
  }
  return <p>I am a very slow component tree.</p>;
}
```

[Try it here]()

The problem is that whenever `color` changes inside `App`, we will re-render `<ExpensiveTree />` which we’ve artificially delayed to be very slow.

I could [put `memo()` on it]() and call it a day, but there are many existing articles about it so I won’t spend time on it. I want to show two different solutions.

> Note, there are situations where default values are useful,
> but most of the time they're not necessary or useful.

## Solution 1: Move State Down

If you look at the rendering code closer, you’ll notice only a part of the returned tree actually cares about the current `color`:

```js {2,5-6}
export default function App() {
  let [color, setColor] = useState('red');
  return (
    <div>
      <input value={color} onChange={(e) => setColor(e.target.value)} />
      <p style={{ color }}>Hello, world!</p>
      <ExpensiveTree />
    </div>
  );
}
```

## Conclusion

A magic number is a number in code with no clear meaning to the reader. Magic numbers should be avoided and instead be replaced with named constants. It'll help with readability and maintainability!

Resources:

<ul>

<li
  style="background-image: linear-gradient(transparent 70%,#dbe4ff 0);
box-sizing: border-box;
color: #2a5aa7;
cursor: pointer;
font-family: Roboto,sans-serif;
font-weight: 700;
letter-spacing: .4px;
line-height: 24px;
text-decoration: none;width:max-content;"
>
  ESLint no-magic-numbers
</li>

<li style="background-image: linear-gradient(transparent 70%,#dbe4ff 0);
box-sizing: border-box;
color: #2a5aa7;
cursor: pointer;
font-family: Roboto,sans-serif;
font-weight: 700;
letter-spacing: .4px;
line-height: 24px;
text-decoration: none;width:max-content;"> Lodash</li>
<li style="background-image: linear-gradient(transparent 70%,#dbe4ff 0);
box-sizing: border-box;
color: #2a5aa7;
cursor: pointer;
font-family: Roboto,sans-serif;
font-weight: 700;
letter-spacing: .4px;
line-height: 24px;
text-decoration: none;width:max-content;"> Lodash samplesize documentation</li>
<li style="background-image: linear-gradient(transparent 70%,#dbe4ff 0);
box-sizing: border-box;
color: #2a5aa7;
cursor: pointer;
font-family: Roboto,sans-serif;
font-weight: 700;
letter-spacing: .4px;
line-height: 24px;
text-decoration: none;width:max-content;">Lodash's sampleSize function</li>
</ul>
